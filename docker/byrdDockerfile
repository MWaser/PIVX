FROM ubuntu:xenial
MAINTAINER Mark Waser <mark@artificialgeneralintelligenceinc.com>
ENV DEBIAN_FRONTEND noninteractive
WORKDIR /shared
RUN apt-get update && \
apt-get --no-install-recommends -yq install software-properties-common && \
add-apt-repository ppa:bitcoin/bitcoin 
RUN apt-get update && \
apt-get --no-install-recommends -yq install \
libdb4.8-dev \
libdb4.8++-dev \
libboost-all-dev \
libssl-dev \
libevent-dev \
locales \
git-core \
build-essential \
ca-certificates \
autoconf \
automake \
pkg-config \
libtool \
autotools-dev \
bsdmainutils \
vim \
ruby \
dos2unix \
sudo \
rsync && \
apt-get -yq purge grub > /dev/null 2>&1 || true && \
apt-get -y dist-upgrade && \
locale-gen en_US.UTF-8 && \
update-locale LANG=en_US.UTF-8 && \
bash -c '[[ -d /shared/gitian-builder ]] || git clone https://github.com/kleetus/gitian-builder /shared/gitian-builder' && \
useradd -d /home/ubuntu -m -s /bin/bash ubuntu && \
useradd pivx && \
useradd divi && \
chown -R ubuntu.ubuntu /shared/ && \
chown root.root /shared/gitian-builder/target-bin/grab-packages.sh && \
chmod 755 /shared/gitian-builder/target-bin/grab-packages.sh && \
echo 'ubuntu ALL=(root) NOPASSWD: ALL,/shared/gitian-builder/target-bin/grab-packages.sh' > /etc/sudoers.d/ubuntu && \
chown root.root /etc/sudoers.d/ubuntu && \
chmod 0400 /etc/sudoers.d/ubuntu && \
chown -R ubuntu.ubuntu /home/ubuntu
USER ubuntu
RUN printf "[[ -d /shared/pivx ]] || \
git clone -b \$1 --depth 1 \$2 /shared/pivx && \
cd /shared/gitian-builder; \
./bin/gbuild --skip-image --commit pivx=\$1 --url pivx=\$2 \$3" > /home/ubuntu/runit.sh
RUN dos2unix /home/ubuntu/runit.sh
RUN chmod 777 /home/ubuntu/runit.sh
# CMD ["v3.0.6","https://github.com/PIVX-Project/pivx.git","../pivx/contrib/gitian-descriptors/gitian-linux.yml"]
# ENTRYPOINT ["bash", "/home/ubuntu/runit.sh"]

# gitian build pivx
# git clone -b "3.0" --depth 1 "https://github.com/PIVX-Project/pivx.git" /shared/pivx
# vi /shared/ubuntu/pivx/contrib/gitian-descriptors/gitian-linux.yml
# cd /shared/gitian-builder
# ./bin/gbuild --skip-image --commit pivx="3.0" --url pivx="https://github.com/PIVX-Project/pivx.git" "../pivx/contrib/gitian-descriptors/gitian-linux.yml"

# install pivx
# cd /home/ubuntu/build
# ./autogen.sh
# ./configure
# make
# make install

# build divi  <== CURRENT GITIAN BUILD
# git clone -b "master" --depth 1 "https://cbyrdsw:Justic3123@agii.visualstudio.com/_git/DiviProject" /shared/pivx
# cd /shared/gitian-builder
# ./bin/gbuild --skip-image --commit pivx="3.0" --url pivx="https://github.com/PIVX-Project/pivx.git" "../pivx/contrib/dev-core/dev-core-linux.yml"

# install divi
# cd /home/ubuntu/build
# ./autogen.sh
# ./configure
# make
# sudo make install

# CURRENT BUILD
# git clone -b "master" --depth 1 "https://cbyrdsw:Justic3123@agii.visualstudio.com/_git/DiviProject" /shared/pivx
# cd /shared/pivx
# ./autogen.sh
# ./configure
# make
# sudo make install
# cd /home/ubuntu
# apt-get install wget
# sudo wget https://raw.githubusercontent.com/PIVX-Project/PIVX/master/contrib/debian/examples/pivx.conf
# 

#notes
# /home/ubuntu/runit.sh "master" "https://cbyrdsw:Justic3123@agii.visualstudio.com/_git/DiviProject" "../pivx/contrib/dev-core/dev-core-linux.yml"

# this line is if you want to build without wallet or gui and debug enabled
# git clone -b "master" --depth 1 "https://cbyrdsw:Justic3123@agii.visualstudio.com/_git/DiviProject" /shared/pivx
# ./configure --disable-wallet --without-gui --enable-debug
# ./configure --without-gui --enable-debug

